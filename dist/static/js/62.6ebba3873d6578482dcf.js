webpackJsonp([62],{412:function(e,t,i){"use strict";function a(e,t,i){var a=e.getTime();if("0"==i){return r(a+24*(t-1)*3600*1e3)}if("1"==i){for(var m=1900+e.getYear(),o=e.getMonth()+1,p=null,h=0;h<t;h++)p+=s(m,o++);return r(a+24*(p-1)*3600*1e3)}for(var d=1900+e.getYear(),c=0,u=0;u<t;u++)d+=1,n(d)?c+=366:c+=365;return r(a+24*(c-1)*3600*1e3)}function r(e){var t=new Date(e),i=1900+t.getYear(),a="0"+(t.getMonth()+1),r="0"+t.getDate();t.getHours(),t.getMinutes();return i+"-"+a.substring(a.length-2,a.length)+"-"+r.substring(r.length-2,r.length)}function s(e,t){return new Date(e,t,0).getDate()}function n(e){return e%4==0&&(e%100!=0||e%400==0)}Object.defineProperty(t,"__esModule",{value:!0});var m=i(240),o=function(e){return e&&e.__esModule?e:{default:e}}(m),p=i(92),h=i(2);t.default={computed:{},data:function(){var e=this;return{excelImportShow:!1,filters:{condition:"carNum",conditionTime:"valid_time",what:"",whatTime:null,containExpire:!0,showOtherPark:!0},payTypeList:this.Util.payTypeList,vip_INFO:{carNum:"",memberName:"",applyUnit:"月",payType:"现金支付",returnFee:!1,payTime:new Date,idCard:"",phoneNum:"",company:"",applyLength:1,memberRateIndex:"",memberRateId:"",memberRatesId:"",memberType:"",effectTime:new Date,effTime:"",expireTime:"",expTime:"",payMoney:0,vipId:"",remark:""},isEffectTime:!1,applyUnitList:[],RateList:[],sels:[],array:[],currentPage:1,total:0,pageSize:10,listLoading:!1,editTimelength:0,isUserType:!1,isHandle:!1,handleFormVisible:!1,innerVisible:!1,handleLoading:!1,handleFormRules:{carNum:[{required:!0,message:"请输入车牌",trigger:"blur"},{required:!0,validator:this.Check.ruleCarNum,trigger:"blur"}]},pickerOptions:{disabledDate:function(t){if(!e.isHandle)return t.getTime()>(new Date).getTime()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}}]},renewLoading:!1,renewVisible:!1,costChangeFormVisible:!1,costChangeLoading:!1,editFormVisible:!1,editLoading:!1,editFormRules:{carNum:[{required:!0,message:"请输入companyid",trigger:"blur"}]},hangUpLoading:!1}},mounted:function(){this.getVipList(!1),this.getListMemberRate()},beforeUpdate:function(){document.getElementById("menu-box-6").classList.add("menu-active")},methods:{exportExcel:function(){var e=this;i.e(0).then(function(){var t=i(361),a=t.export_json_to_excel,r=["车牌号","生效时间","失效时间","会员类型","办理时间","收费停车场","车主姓名","状态","挂起时间","备注"],s=["carNum","startTime","stopTime","memberType","createTime","parkName","owner","memberStatus","lockTime","remark"],n=e.Util.deepCopy(e.array);a(r,e.Util.formatJson(s,n),"会员信息")}.bind(null,i)).catch(i.oe)},memberRateChange:function(){var e=this.RateList[this.vip_INFO.memberRateIndex];this.vip_INFO.memberRateId=e.id,this.applyUnitList=[],e.dayMoney&&this.applyUnitList.push("天"),e.monthMoney&&this.applyUnitList.push("月"),e.yearMoney&&this.applyUnitList.push("年"),this.vip_INFO.applyUnit=this.applyUnitList[0],this.timeAndMoney()},closeMemberDialog:function(){},styleSpecial:function(e){return 0==e.row.memberStatus?{color:"#F56C6C"}:1==e.row.memberStatus?{color:"#1e00ff"}:void 0},handleSizeChange:function(e){this.pageSize=e,this.getVipList(!1)},handleCurrentChange:function(e){this.currentPage=e,this.getVipList(!1)},handleSelectionChange:function(e){this.sels=e},indexMethod:function(e){return e+this.pageSize*(this.currentPage-1)},getVipList:function(e){var t=this,i=this.filters.condition,a=this.filters.conditionTime,r=this.filters.what,s=this.filters.whatTime,n={};n[i]=r;var m={operatorId:this.Util.userInfo.id,containExpire:!0,showOtherPark:!0};if(s)if("valid_time"==a)m.effectLowTime=this.Util.formatDate.format(s[0],"yyyy-MM-dd"),m.effectUpTime=this.Util.formatDate.format(s[1],"yyyy-MM-dd");else{var h=s[0].getTime(),d=s[1].getTime();h===d&&(d+=864e5-1),m.applyLowTime=this.Util.formatDate.format(new Date(h),"yyyy-MM-dd hh:mm:ss"),m.applyUpTime=this.Util.formatDate.format(new Date(d),"yyyy-MM-dd hh:mm:ss")}m.length=this.pageSize,m.containExpire=this.filters.containExpire,m.showOtherPark=this.filters.showOtherPark,m.current=e?0:this.currentPage-1;var c=(0,o.default)(m,n);(0,p.vipList)(c).then(function(e){"SUCCESS"==e.data.code?(t.array=e.data.data.content,t.array.forEach(function(e){0===e.memberStatus?e.memberStatus="未生效":1===e.memberStatus?e.memberStatus="生效":2===e.memberStatus?e.memberStatus="失效":3===e.memberStatus?e.memberStatus="挂起":e.memberStatus="解挂"}),t.total=e.data.data.totalElements):t.$message.error(e.data.msg)})},getListMemberRate:function(){var e=this,t={operatorId:this.Util.userInfo.id};(0,p.listMemberRateSim)(t).then(function(t){"SUCCESS"==t.data.code?e.RateList=t.data.data:e.$message.error(t.data.msg)})},handleIVP:function(){this.isEffectTime=!1,this.handleFormVisible=!0,this.isHandle=!0,this.vip_INFO.carNum="",this.vip_INFO.memberName="",this.vip_INFO.applyUnit="月",this.vip_INFO.payType="现金支付",this.vip_INFO.returnFee=!1,this.vip_INFO.payTime=new Date,this.vip_INFO.idCard="",this.vip_INFO.phoneNum="",this.vip_INFO.company="",this.vip_INFO.applyLength=1,this.vip_INFO.memberRateIndex="",this.vip_INFO.memberRateId="",this.vip_INFO.memberRatesId="",this.vip_INFO.memberType="",this.vip_INFO.effectTime=new Date,this.vip_INFO.effTime="",this.vip_INFO.expireTime="",this.vip_INFO.expTime="",this.vip_INFO.payMoney="",this.vip_INFO.vipId="",this.vip_INFO.remark=""},handleRenew:function(e,t){var i=this;this.vip_INFO.carNum=t.carNum,this.vip_INFO.memberType=t.memberType,this.vip_INFO.memberName=t.owner,this.vip_INFO.idCard=t.idcard,this.vip_INFO.phoneNum=t.telephone,this.vip_INFO.company=t.company,this.vip_INFO.memberRateId=t.memberRatesId,this.vip_INFO.vipId=t.id,this.vip_INFO.remark=t.remark,this.vip_INFO.applyUnit=t.applyUnit,this.isHandle=!1,this.applyUnitList=[];for(var a=0;a<this.RateList.length;a++)if(this.vip_INFO.memberRateId==this.RateList[a].id){var r=this.RateList[a];r.dayMoney&&this.applyUnitList.push("天"),r.monthMoney&&this.applyUnitList.push("月"),r.yearMoney&&this.applyUnitList.push("年")}(new Date).getTime()<=new Date(t.stopTime).getTime()?this.$confirm("月卡未到期, 是否继续续费?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){i.handleFormVisible=!0,i.vip_INFO.effectTime=new Date(t.stopTime),i.vip_INFO.effTime=t.stopTime,i.isEffectTime=!0,i.timeAndMoney()}).catch(function(e){}):(this.isEffectTime=!1,this.vip_INFO.effectTime=new Date,this.handleFormVisible=!0)},handleChange:function(e,t){this.costChangeFormVisible=!0,this.vip_INFO.carNum=t.carNum,this.vip_INFO.effTime=t.startTime?this.Util.formatDate.format(new Date(t.startTime),"yy-MM-dd"):"",this.vip_INFO.expTime=t.stopTime?this.Util.formatDate.format(new Date(t.stopTime),"yy-MM-dd"):"",this.vip_INFO.memberType=t.memberType,this.vip_INFO.vipId=t.id},handleEdit:function(e,t){var i=new Date(t.startTime).getTime(),a=new Date(t.stopTime).getTime();this.editTimelength=a-i,this.editFormVisible=!0,this.vip_INFO.carNum=t.carNum,this.vip_INFO.effectTime=new Date(t.startTime),this.vip_INFO.expTime=t.stopTime?this.Util.formatDate.format(new Date(t.stopTime),"yy-MM-dd"):"",this.vip_INFO.expireTime=new Date(t.stopTime),this.vip_INFO.memberType=t.memberType,this.vip_INFO.memberName=t.owner,this.vip_INFO.memberRateId=t.memberRatesId,this.vip_INFO.idCard=t.idcard,this.vip_INFO.phoneNum=t.telephone,this.vip_INFO.company=t.company,this.vip_INFO.vipId=t.id},openMemberChart:function(){var e=this;this.isUserType=!0;var t={operatorId:this.Util.userInfo.id};(0,p.vipTypeCount)(t).then(function(t){"SUCCESS"==t.data.code?e.chartUserSum(t.data.data):e.$message.error(t.data.msg)})},chartUserSum:function(e){for(var t=[],i=[],a=0,r=0,s=e.length;r<s;r++)t.push(e[r].memberType),i.push(e[r].number),a+=e[r].number;var n=document.getElementById("userTypeBar"),m=h.init(n),o={title:{text:"会员信息统计表 总计:"+a,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},grid:{right:"20%",tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0,formatter:function(e){return e.value.replace("\n","")}}}}},toolbox:{feature:{dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0}}},xAxis:[{type:"category",data:t}],yAxis:[{type:"value",name:"",axisLabel:{formatter:"{value} "}}],series:[{name:"",type:"bar",data:i,itemStyle:{normal:{color:function(e){return["#C33531","#EFE42A","#64BD3D","#EE9201","#29AAE3","#B74AE5","#0AAF9F","#E89589"][e.dataIndex]}},emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},barWidth:30}]};m.setOption(o)},handleSubmit:function(){var e=this,t=this;this.$refs.handleForm.validate(function(i){if(i){var a=e.Util.deepCopy(e.vip_INFO);a.operatorId=e.Util.userInfo.id,a.expireTime=t.vip_INFO.expTime,a.effectTime=e.Util.formatDate.format(t.vip_INFO.effectTime,"yyyy-MM-dd"),a.payTime=e.Util.formatDate.format(t.vip_INFO.payTime,"yyyy-MM-dd hh:mm:ss"),e.isHandle?e.memberAdd(a):e.memberRenewals(a)}})},memberAdd:function(e){var t=this;(0,p.vipAdd)(e).then(function(e){"SUCCESS"==e.code?(t.$message({type:"success",message:e.msg}),t.handleFormVisible=!1,t.innerVisible=!1,t.handleLoading=!1,t.getVipList(!1)):t.$message.error(e.msg)})},memberRenewals:function(e){var t=this,i={applyLength:e.applyLength,applyUnit:e.applyUnit,expireTime:e.expireTime,effectTime:e.effectTime,operatorId:e.operatorId,payMoney:Number(e.payMoney),payType:e.payType,payTime:e.payTime,remark:e.remark,id:e.vipId};(0,p.feeRenewals)(i).then(function(e){"SUCCESS"==e.code?(t.$message({type:"success",message:e.msg}),t.innerVisible=!1,t.handleFormVisible=!1,t.handleLoading=!1,t.getVipList(!1)):t.$message.error(e.msg)})},costChangeSubmit:function(){var e=this;this.$refs.costChangeForm.validate(function(t){if(t){e.costChangeLoading=!1;var i={operatorId:e.Util.userInfo.id,payMoney:Number(e.vip_INFO.payMoney),payType:e.vip_INFO.payType,remark:e.vip_INFO.remark,returnFee:e.vip_INFO.returnFee,id:e.vip_INFO.vipId};(0,p.feeChange)(i).then(function(t){"SUCCESS"==t.code?(e.$message({type:"success",message:t.msg}),e.costChangeFormVisible=!1,e.getVipList(!1)):e.$message({type:"warning",message:t.msg})}).catch(function(e){console.log(e)})}})},editSubmit:function(){var e=this;this.$refs.editForm.validate(function(t){if(t){e.editLoading=!1,e.editFormVisible=!1,console.log(e.vip_INFO);var i={carNum:e.vip_INFO.carNum,company:e.vip_INFO.company,idCard:e.vip_INFO.idCard,memberName:e.vip_INFO.memberName,expireTime:e.Util.formatDate.format(e.vip_INFO.expireTime,"yyyy-MM-dd"),effectTime:e.Util.formatDate.format(e.vip_INFO.effectTime,"yyyy-MM-dd"),memberRateId:e.vip_INFO.memberRateId,operatorId:e.Util.userInfo.id,phoneNum:e.vip_INFO.phoneNum,remark:e.vip_INFO.remark,id:e.vip_INFO.vipId};(0,p.infoUpdate)(i).then(function(t){"SUCCESS"==t.code?(e.$message({type:"success",message:t.msg}),e.getVipList(!1)):e.$message.error(t.msg)})}})},handleDelete:function(e,t){var i=this;this.$confirm("确认删除该记录吗?","提示",{type:"warning"}).then(function(){var e={operatorId:i.Util.userInfo.id,id:t.id};(0,p.vipDelete)(e).then(function(e){"SUCCESS"==e.code?(i.getVipList(!1),i.$message({type:"success",message:e.msg})):i.$message.error(e.msg)})})},handleHangUp:function(e,t){var i=this,a={operatorId:this.Util.userInfo.id,id:t.id},r="挂起";r=t.lockTime?"解挂":"挂起",t.lockTime?a.lockOption=!1:a.lockOption=!0,this.$confirm("是否要将车牌号为"+t.carNum+"的月卡"+r+"?","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){(0,p.vipPause)(a).then(function(e){"SUCCESS"==e.code?(i.$message({type:"success",message:e.msg}),i.getVipList(!1)):i.$message.error(e.msg)})}).catch(function(){})},batchDelete:function(){var e=this;this.$confirm("确认删除选中的记录吗?","提示",{type:"warning"}).then(function(){var t=[];for(var i in e.sels)t.push(e.sels[i].id);var a={idList:t,operatorId:e.Util.userInfo.id};(0,p.vipBatchDelete)(a).then(function(t){"SUCCESS"==t.code?(e.getVipList(!1),e.$message({type:"success",message:t.msg}),e.getVipList(!1)):e.$message.error(t.msg)})})},timeChange:function(){var e=new Date(this.vip_INFO.effectTime).getTime()+this.editTimelength;this.vip_INFO.expTime=this.Util.formatDate.format(new Date(e),"yy-MM-dd"),this.vip_INFO.expireTime=new Date(e)},timeAndMoney:function(){var e=this.vip_INFO.effectTime,t=this.vip_INFO.applyUnit,i=this.vip_INFO.memberRateId,r=Number(this.vip_INFO.applyLength);"天"===t?(this.vip_INFO.expTime=e?a(e,r,"0"):"",this.vip_INFO.payMoney=this.MMoney(i,"0",r)):"月"===t?(this.vip_INFO.expTime=e?a(e,r,"1"):"",this.vip_INFO.payMoney=this.MMoney(i,"1",r)):(this.vip_INFO.expTime=e?a(e,r,"2"):"",this.vip_INFO.payMoney=this.MMoney(i,"2",r))},changeTimeStr:function(e){return e?this.Util.formatDate.format(e,"yy-MM-dd"):""},MMoney:function(e,t,i){return this.getPrice(e,t)*Number(i)},getPrice:function(e,t){for(var i=this.RateList,a=0;a<i.length;a++)if(e==i[a].id)return"0"===t?i[a].dayMoney:"1"===t?i[a].monthMoney:i[a].yearMoney;return 0}}}}});